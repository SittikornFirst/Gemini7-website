<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gemini Science Plan Management</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        h1 { text-align: center; }
        form { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        input, select, textarea, button { display: block; width: 100%; padding: 8px; margin-top: 10px; margin-bottom: 20px; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #response { white-space: pre-wrap; background: #e8e8e8; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>

<h1>Manage Science Plan</h1>

<form id="sciencePlanForm">
    <label>Plan Name</label>
    <input type="text" id="planName" required>

    <label>Funding (USD)</label>
    <input type="number" id="funding" step="0.01" required>

    <label>Objective</label>
    <textarea id="objective" rows="3" required></textarea>

    <label>Start Date</label>
    <input type="datetime-local" id="startDate" required>

    <label>End Date</label>
    <input type="datetime-local" id="endDate" required>

    <label>Telescope</label>
    <select id="telescope">
        <option value="HAWAII">Hawaii</option>
        <option value="CHILE">Chile</option>
    </select>

    <label>Target Star System</label>
    <select id="starSystem">
        <option value="Auriga">Auriga</option>
        <option value="Antlia">Antlia</option>
        <option value="Andromeda">Andromeda</option>
        <!-- Add more if needed -->
    </select>

    <h3>Data Processing Requirements</h3>

    <label>File Type</label>
    <select id="fileType">
        <option value="PNG">PNG</option>
        <option value="JPEG">JPEG</option>
        <option value="RAW">RAW</option>
    </select>

    <label>File Quality</label>
    <select id="fileQuality">
        <option value="Low">Low</option>
        <option value="Fine">Fine</option>
    </select>

    <label>Color Type</label>
    <select id="colorType">
        <option value="Color mode">Color mode</option>
        <option value="B&W mode">B&W mode</option>
    </select>

    <label>Contrast</label>
    <input type="number" id="contrast" step="0.1">

    <label>Brightness</label>
    <input type="number" id="brightness" step="0.1">

    <label>Saturation</label>
    <input type="number" id="saturation" step="0.1">

    <label>Highlights</label>
    <input type="number" id="highlights" step="0.1">

    <label>Exposure</label>
    <input type="number" id="exposure" step="0.1">

    <label>Shadows</label>
    <input type="number" id="shadows" step="0.1">

    <label>Whites</label>
    <input type="number" id="whites" step="0.1">

    <label>Blacks</label>
    <input type="number" id="blacks" step="0.1">

    <label>Luminance</label>
    <input type="number" id="luminance" step="0.1">

    <label>Hue</label>
    <input type="number" id="hue" step="0.1">

    <button type="button" onclick="createSciencePlan()">Save Science Plan</button>
</form>

<div style="text-align: center;">
    <button onclick="testSciencePlan()">Test Science Plan</button>
    <button onclick="submitSciencePlan()">Submit Science Plan</button>
</div>

<h2>Result</h2>
<pre id="response"></pre>

<script>
    let lastCreatedPlan = null;

    function getFormData() {
      return {
        planName: document.getElementById('planName').value,
        fundingInUSD: parseFloat(document.getElementById('funding').value),
        objectives: document.getElementById('objective').value,
        startDate: new Date(document.getElementById('startDate').value).toISOString().replace('T', ' ').substring(0, 19),
        endDate: new Date(document.getElementById('endDate').value).toISOString().replace('T', ' ').substring(0, 19),
        telescopeLocation: document.getElementById('telescope').value,
        starSystem: document.getElementById('starSystem').value,
        dataProcRequirements: {
          fileType: document.getElementById('fileType').value,
          fileQuality: document.getElementById('fileQuality').value,
          colorType: document.getElementById('colorType').value,
          contrast: parseFloat(document.getElementById('contrast').value),
          brightness: parseFloat(document.getElementById('brightness').value),
          saturation: parseFloat(document.getElementById('saturation').value),
          highlights: parseFloat(document.getElementById('highlights').value),
          exposure: parseFloat(document.getElementById('exposure').value),
          shadows: parseFloat(document.getElementById('shadows').value),
          whites: parseFloat(document.getElementById('whites').value),
          blacks: parseFloat(document.getElementById('blacks').value),
          luminance: parseFloat(document.getElementById('luminance').value),
          hue: parseFloat(document.getElementById('hue').value)
        }
      };
    }

    function createSciencePlan() {
      const data = getFormData();
      fetch('http://localhost:8080/api/plan/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(response => response.text())
      .then(result => {
        lastCreatedPlan = data; // save data for later test or submit
        document.getElementById('response').innerText = "CREATE RESPONSE:\n" + result;
        alert("✅ Science Plan Saved!");
      });
    }

    function testSciencePlan() {
      if (!lastCreatedPlan) {
        alert("⚠️ Please create a science plan first!");
        return;
      }
      fetch('http://localhost:8080/api/plan/test', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(lastCreatedPlan)
      })
      .then(response => response.text())
      .then(result => {
        document.getElementById('response').innerText = "TEST RESPONSE:\n" + result;
        alert("✅ Science Plan Tested (check the result). Now you can submit!");
      });
    }

    function submitSciencePlan() {
      if (!lastCreatedPlan) {
        alert("⚠️ Please create and test a science plan first!");
        return;
      }
      fetch('http://localhost:8080/api/plan/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(lastCreatedPlan)
      })
      .then(response => response.text())
      .then(result => {
        document.getElementById('response').innerText = "SUBMIT RESPONSE:\n" + result;
        alert("✅ Science Plan Submitted!");
      });
    }
</script>

</body>
</html>
